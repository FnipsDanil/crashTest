# üéÅ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤ —á–µ—Ä–µ–∑ userbot.

## üìã –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `verified_senders` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `003_add_verified_senders.py`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `VerifiedSender` –≤ SQLAlchemy

### 2. **Backend —Å–µ—Ä–≤–∏—Å**
- ‚úÖ –°–æ–∑–¥–∞–Ω `auto_gift_sender.py` - —Ñ–æ–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ lifecycle FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

### 3. **Docker –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `userbot-gifter` –≤ docker-compose.yml
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Å–≤—è–∑—å —Å –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ session —Ñ–∞–π–ª–∞ –¥–ª—è userbot

1. –ü–µ—Ä–µ–π–¥–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é session-generator:
```bash
cd /crash/session-generator
```

2. –ó–∞–ø—É—Å—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä session:
```bash
sh run.sh
```

3. –°–ª–µ–¥—É–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º:
   - –í–≤–µ–¥–∏ API ID –∏ API Hash —Å https://my.telegram.org/apps
   - –í–≤–µ–¥–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è userbot
   - –í–≤–µ–¥–∏ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–∑ Telegram
   - –í–≤–µ–¥–∏ –∏–º—è session —Ñ–∞–π–ª–∞: `userbot_session`

4. –°–∫–æ–ø–∏—Ä—É–π —Å–æ–∑–¥–∞–Ω–Ω—ã–π session —Ñ–∞–π–ª –≤ userbot-gifter:
```bash
cp userbot_session.session ../userbot-gifter/sessions/
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å –≤ —Ñ–∞–π–ª `.env` —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
# === Auto Gift Sender Configuration ===

# Telegram API credentials –¥–ª—è userbot (–ø–æ–ª—É—á–∏—Ç—å –Ω–∞ https://my.telegram.org/apps)
TELEGRAM_USERBOT_API_ID=your_api_id
TELEGRAM_USERBOT_API_HASH=your_api_hash

# URL userbot-gifter API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é http://userbot-gifter:8000)
USERBOT_GIFTER_URL=http://userbot-gifter:8000

# –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
GIFT_SENDER_CHECK_INTERVAL=30

# –í—Ä–µ–º—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤ —á–∞—Å–∞—Ö)
MESSAGE_VERIFICATION_HOURS=48

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–æ–≤ (true/false)
# –í–ù–ò–ú–ê–ù–ò–ï: –í–∫–ª—é—á–∞–π —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–≤–µ—Ä–µ–Ω –≤ –ª–æ–≥–∏–∫–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏!
AUTO_APPROVE_GIFTS=false
```

### –®–∞–≥ 3: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
cd /crash/backend
poetry run alembic upgrade head
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—É `verified_senders` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

### –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

```bash
cd /crash
docker-compose up -d --build
```

–ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏:
```bash
# –õ–æ–≥–∏ backend (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "Auto Gift Sender started")
docker logs -f api

# –õ–æ–≥–∏ userbot-gifter
docker logs -f userbot-gifter
```

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ—Ü–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥–∞—Ä–∫–æ–≤:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –ø–æ–¥–∞—Ä–æ–∫**
   - Frontend ‚Üí Backend API `/purchase-gift`
   - –ë–∞–ª–∞–Ω—Å —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å–æ —Å—á—ë—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –°–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `payment_requests` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`

2. **–ê–¥–º–∏–Ω –æ–¥–æ–±—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å** (–≤—Ä—É—á–Ω—É—é –∏–ª–∏ —á–µ—Ä–µ–∑ API)
   - –°—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è —Å `pending` –Ω–∞ `approved`

3. **Auto Gift Sender –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–µ `GIFT_SENDER_CHECK_INTERVAL` —Å–µ–∫—É–Ω–¥
   - –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ `payment_requests` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `approved`
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:
     - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é: –µ—Å—Ç—å –ª–∏ user –≤ `verified_senders`
     - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (< `MESSAGE_VERIFICATION_HOURS` —á–∞—Å–æ–≤)
     - ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ user –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (`is_blocked = false`)
     - ‚úÖ –í—ã–∑—ã–≤–∞–µ—Ç API userbot-gifter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥–∞—Ä–∫–∞

4. **Userbot-gifter –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥–∞—Ä–æ–∫**
   - –ù–∞—Ö–æ–¥–∏—Ç –ø–æ–¥–∞—Ä–æ–∫ –≤ —Å–≤–æ—ë–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É –∏–º–µ–Ω–∏
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ Telegram MTProto API
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

5. **Backend –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å**
   - ‚úÖ –£—Å–ø–µ—Ö: `status = 'completed'`
   - ‚ùå –ù–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω: `status = 'canceled', cancel_reason = 'no_message'`
   - ‚ùå –û—à–∏–±–∫–∞: –æ—Å—Ç–∞—ë—Ç—Å—è `approved` –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏

6. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤**
   - –¢—Ä–∏–≥–≥–µ—Ä `auto_refund_on_payment_cancel` –≤ –ë–î
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `price_stars` –Ω–∞ –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 50% –æ—Ç `price_stars` –≤ `wagered_balance`
   - –°–æ–∑–¥–∞—ë—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Ç–∏–ø–∞ `refund`

## üìä –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ `verified_senders` –∫–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ userbot'—É.

### –°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã `verified_senders`:
```sql
CREATE TABLE verified_senders (
    chat_id BIGINT PRIMARY KEY,              -- Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    username VARCHAR(255),                   -- Username
    first_name VARCHAR(255),
    last_name VARCHAR(255),
    verified_at TIMESTAMP,                   -- –ü–µ—Ä–≤–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
    last_message_at TIMESTAMP,               -- –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    message_count INTEGER DEFAULT 1,         -- –°—á—ë—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
    is_blocked BOOLEAN DEFAULT FALSE,        -- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–≤—Ä—É—á–Ω—É—é)
    notes TEXT                               -- –ó–∞–º–µ—Ç–∫–∏ –∞–¥–º–∏–Ω–∞
);
```

### –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ userbot'—É
2. Userbot –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ `events.NewMessage`
3. –î–æ–±–∞–≤–ª—è–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ `verified_senders`
4. –ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –ø–æ–¥–∞—Ä–∫–∞ Auto Gift Sender –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   - –ï—Å—Ç—å –ª–∏ user –≤ `verified_senders`
   - `last_message_at` < 48 —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `MESSAGE_VERIFICATION_HOURS`)
   - `is_blocked = false`

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ SQL

### –û–¥–æ–±—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –ø–æ–¥–∞—Ä–∫–∞:
```sql
UPDATE payment_requests
SET status = 'approved', approved_at = NOW()
WHERE id = <request_id>;
```

### –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```sql
UPDATE verified_senders
SET is_blocked = TRUE, notes = 'Fraud detected'
WHERE chat_id = <telegram_id>;
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
```sql
SELECT pr.id, u.telegram_id, u.username, g.name as gift_name, pr.price_stars, pr.status, pr.created_at
FROM payment_requests pr
JOIN users u ON pr.user_id = u.id
JOIN gifts g ON pr.gift_id = g.id
WHERE pr.status = 'approved'
ORDER BY pr.approved_at;
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
```sql
SELECT chat_id, username, last_message_at, message_count, is_blocked
FROM verified_senders
WHERE is_blocked = FALSE
  AND last_message_at > NOW() - INTERVAL '48 hours'
ORDER BY last_message_at DESC;
```

## üîß –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É Auto Gift Sender:
```bash
# –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ backend
docker logs -f api | grep "Auto Gift"

# –û–∂–∏–¥–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
# ‚úÖ Auto Gift Sender started
# üì¶ Found X approved gift requests to process
# üéÅ Processing gift request #123 for user 456
# ‚úÖ Gift request #123 completed successfully
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É Userbot Gifter:
```bash
# –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ userbot
docker logs -f userbot-gifter

# –û–∂–∏–¥–∞–µ–º—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:
# üöÄ Starting Telethon client...
# ‚úÖ Telethon client started
# üìö –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤ –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è...
# üëÇ Listening for incoming messages...
```

### –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ userbot API:
```bash
curl -X POST http://localhost:8001/transfer-gift \
  -H "Content-Type: application/json" \
  -d '{
    "gift_name_prefix": "delicious",
    "recipient_id": 123456789,
    "star_count": 25
  }'
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ:
```bash
curl http://localhost:8001/list-gifts
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Session —Ñ–∞–π–ª**
   - –•—Ä–∞–Ω–∏ session —Ñ–∞–π–ª –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   - –ù–µ –∫–æ–º–º–∏—Ç—å –≤ git
   - –°–æ–∑–¥–∞–≤–∞–π –æ—Ç–¥–µ–ª—å–Ω—ã–π session –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (dev/prod)

2. **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –Ω–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ userbot'—É –î–û –ø–æ–∫—É–ø–∫–∏ –ø–æ–¥–∞—Ä–∫–∞
   - –í—Ä–µ–º—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `MESSAGE_VERIFICATION_HOURS`
   - –ú–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —á–µ—Ä–µ–∑ `is_blocked`

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - Userbot API –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ localhost (`127.0.0.1:8001`)
   - –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–π –ø–æ—Ä—Ç 8001 –Ω–∞—Ä—É–∂—É
   - –ò—Å–ø–æ–ª—å–∑—É–π `AUTO_APPROVE_GIFTS=false` –ø–æ–∫–∞ –Ω–µ —É–≤–µ—Ä–µ–Ω –≤ –ª–æ–≥–∏–∫–µ

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –°–ª–µ–¥–∏ –∑–∞ –ª–æ–≥–∞–º–∏ Auto Gift Sender
   - –ü—Ä–æ–≤–µ—Ä—è–π —Å—Ç–∞—Ç—É—Å—ã –≤ `payment_requests`
   - –ú–æ–Ω–∏—Ç–æ—Ä—å `verified_senders` –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∞–Ω–æ–º–∞–ª–∏–π

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–î–æ–±–∞–≤—å —ç—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã –≤ Grafana:

```sql
-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∂–∏–¥–∞—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
SELECT COUNT(*) FROM payment_requests WHERE status = 'approved';

-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã—Ö –∏–∑-–∑–∞ –Ω–µ–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
SELECT COUNT(*) FROM payment_requests
WHERE status = 'canceled' AND cancel_reason = 'no_message'
  AND created_at > NOW() - INTERVAL '24 hours';

-- –°—Ä–µ–¥–Ω–∏–π FPS –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥–∞—Ä–∫–æ–≤
SELECT
    DATE_TRUNC('hour', completed_at) as hour,
    COUNT(*) as gifts_sent
FROM payment_requests
WHERE status = 'completed'
  AND completed_at > NOW() - INTERVAL '24 hours'
GROUP BY hour
ORDER BY hour DESC;
```

## üéØ Roadmap

- [ ] API endpoint –¥–ª—è –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ whitelist –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –°–∏—Å—Ç–µ–º–∞ –±–∞–ª–ª–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- [ ] Dashboard –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—á–µ—Ä–µ–¥–∏ –ø–æ–¥–∞—Ä–∫–æ–≤

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-01-14
**–í–µ—Ä—Å–∏—è:** 1.0
